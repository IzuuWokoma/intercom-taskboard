<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IntercomTasks â€” P2P Agent Task Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #f5f0e8;
      --bg2: #ede8df;
      --panel: #ffffff;
      --border: #d4cdc0;
      --amber: #c17f24;
      --amber-light: #f0a93a;
      --amber-dim: rgba(193,127,36,0.12);
      --dark: #1a1612;
      --dark2: #2d2820;
      --text: #2d2820;
      --muted: #9a9080;
      --success: #2d7a3a;
      --error: #b83232;
      --info: #2563a8;
      --font-mono: 'DM Mono', monospace;
      --font-ui: 'Syne', sans-serif;
      --shadow: 0 2px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-mono);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      background-image:
        radial-gradient(circle at 20% 80%, rgba(193,127,36,0.06) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(193,127,36,0.04) 0%, transparent 50%);
    }

    /* HEADER */
    header {
      background: var(--dark);
      color: #f5f0e8;
      padding: 0 24px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
    }

    header::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--amber), var(--amber-light), var(--amber));
    }

    .logo {
      font-family: var(--font-ui);
      font-weight: 800;
      font-size: 1.1rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-badge {
      background: var(--amber);
      color: var(--dark);
      padding: 3px 8px;
      font-size: 0.6rem;
      letter-spacing: 2px;
      font-weight: 700;
      border-radius: 2px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 0.7rem;
      color: rgba(245,240,232,0.5);
      font-family: var(--font-mono);
    }

    .network-pill {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.65rem;
      letter-spacing: 1px;
    }

    .net-dot {
      width: 5px; height: 5px;
      border-radius: 50%;
      background: #4ade80;
      box-shadow: 0 0 6px #4ade80;
      animation: netpulse 2s ease-in-out infinite;
    }

    @keyframes netpulse {
      0%,100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* MAIN LAYOUT */
    .main {
      display: grid;
      grid-template-columns: 280px 1fr 260px;
      flex: 1;
      overflow: hidden;
    }

    /* LEFT PANEL */
    .left-panel {
      background: var(--dark2);
      color: #f5f0e8;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border-right: 1px solid rgba(255,255,255,0.06);
    }

    .panel-header {
      padding: 16px 20px 12px;
      font-family: var(--font-ui);
      font-size: 0.6rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: rgba(245,240,232,0.4);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .filter-list {
      padding: 10px 0;
      flex-shrink: 0;
    }

    .filter-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 9px 20px;
      cursor: pointer;
      font-size: 0.78rem;
      color: rgba(245,240,232,0.6);
      border-left: 2px solid transparent;
      transition: all 0.15s;
    }

    .filter-item:hover { background: rgba(255,255,255,0.04); color: #f5f0e8; }
    .filter-item.active {
      border-left-color: var(--amber);
      color: var(--amber-light);
      background: rgba(193,127,36,0.08);
    }

    .filter-count {
      background: rgba(255,255,255,0.1);
      padding: 2px 7px;
      border-radius: 10px;
      font-size: 0.6rem;
    }

    .filter-item.active .filter-count {
      background: var(--amber);
      color: var(--dark);
    }

    .divider {
      height: 1px;
      background: rgba(255,255,255,0.06);
      margin: 8px 0;
    }

    /* Agents section */
    .agents-section {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
    }

    .agents-section::-webkit-scrollbar { width: 3px; }
    .agents-section::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); }

    .agent-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 7px 20px;
      font-size: 0.72rem;
      color: rgba(245,240,232,0.5);
      cursor: pointer;
      transition: background 0.15s;
    }

    .agent-row:hover { background: rgba(255,255,255,0.03); }

    .agent-av {
      width: 26px; height: 26px;
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-family: var(--font-ui);
      font-weight: 700;
      font-size: 0.6rem;
      flex-shrink: 0;
    }

    .agent-av-info { flex: 1; min-width: 0; }
    .agent-av-name { font-size: 0.75rem; color: rgba(245,240,232,0.8); }
    .agent-av-status { font-size: 0.6rem; margin-top: 1px; }

    .online-dot {
      width: 5px; height: 5px;
      border-radius: 50%;
      background: #4ade80;
      flex-shrink: 0;
    }

    .online-dot.busy { background: var(--amber-light); }
    .online-dot.offline { background: rgba(255,255,255,0.2); }

    /* Trac address box */
    .trac-box {
      padding: 14px 20px;
      border-top: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.2);
    }

    .trac-label {
      font-size: 0.58rem;
      letter-spacing: 2px;
      color: rgba(245,240,232,0.3);
      text-transform: uppercase;
      margin-bottom: 5px;
      font-family: var(--font-ui);
    }

    .trac-addr {
      font-size: 0.6rem;
      color: var(--amber-light);
      word-break: break-all;
      line-height: 1.5;
      opacity: 0.8;
    }

    /* CENTER â€” TASK BOARD */
    .task-board {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--bg);
    }

    .board-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      background: var(--panel);
      box-shadow: var(--shadow);
    }

    .board-title {
      font-family: var(--font-ui);
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--dark);
    }

    .board-subtitle {
      font-size: 0.65rem;
      color: var(--muted);
      margin-top: 2px;
      font-family: var(--font-mono);
    }

    .btn-add {
      background: var(--amber);
      color: white;
      border: none;
      padding: 9px 18px;
      font-family: var(--font-ui);
      font-weight: 700;
      font-size: 0.75rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
      box-shadow: 0 2px 8px rgba(193,127,36,0.3);
    }

    .btn-add:hover {
      background: var(--amber-light);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(193,127,36,0.4);
    }

    /* Kanban columns */
    .kanban {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .kanban::-webkit-scrollbar { width: 4px; }
    .kanban::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

    .column {
      background: var(--bg2);
      border-radius: 10px;
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 0;
    }

    .col-header {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
    }

    .col-title {
      font-family: var(--font-ui);
      font-weight: 700;
      font-size: 0.75rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .col-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
    }

    .col-count {
      font-size: 0.65rem;
      color: var(--muted);
      background: var(--border);
      padding: 2px 7px;
      border-radius: 10px;
      font-family: var(--font-mono);
    }

    .col-tasks {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .col-tasks::-webkit-scrollbar { width: 3px; }
    .col-tasks::-webkit-scrollbar-thumb { background: var(--border); }

    /* Task card */
    .task-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 14px;
      cursor: pointer;
      transition: all 0.15s;
      animation: cardIn 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .task-card::before {
      content: '';
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 3px;
    }

    .task-card.priority-high::before { background: var(--error); }
    .task-card.priority-medium::before { background: var(--amber); }
    .task-card.priority-low::before { background: var(--info); }

    @keyframes cardIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .task-card:hover {
      border-color: var(--amber);
      box-shadow: var(--shadow);
      transform: translateY(-1px);
    }

    .task-title {
      font-family: var(--font-ui);
      font-weight: 600;
      font-size: 0.82rem;
      color: var(--dark);
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .task-desc {
      font-size: 0.68rem;
      color: var(--muted);
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .task-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .task-tags {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .tag {
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.58rem;
      letter-spacing: 0.5px;
      font-family: var(--font-ui);
      font-weight: 600;
      text-transform: uppercase;
    }

    .tag-p2p { background: rgba(37,99,168,0.1); color: var(--info); }
    .tag-agent { background: rgba(193,127,36,0.1); color: var(--amber); }
    .tag-contract { background: rgba(45,122,58,0.1); color: var(--success); }
    .tag-urgent { background: rgba(184,50,50,0.1); color: var(--error); }

    .task-assignee {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.62rem;
      color: var(--muted);
    }

    .assignee-dot {
      width: 18px; height: 18px;
      border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.55rem;
      font-family: var(--font-ui);
      font-weight: 700;
      color: white;
    }

    .task-actions {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
    }

    .task-btn {
      flex: 1;
      padding: 4px;
      border: 1px solid var(--border);
      background: transparent;
      font-size: 0.6rem;
      font-family: var(--font-ui);
      letter-spacing: 0.5px;
      color: var(--muted);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.12s;
      text-transform: uppercase;
    }

    .task-btn:hover { border-color: var(--amber); color: var(--amber); }
    .task-btn.complete:hover { border-color: var(--success); color: var(--success); }
    .task-btn.delete:hover { border-color: var(--error); color: var(--error); }

    /* RIGHT PANEL */
    .right-panel {
      background: var(--panel);
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .rp-header {
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
      font-family: var(--font-ui);
      font-size: 0.6rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .activity-feed {
      flex: 1;
      overflow-y: auto;
      padding: 10px 0;
    }

    .activity-feed::-webkit-scrollbar { width: 3px; }
    .activity-feed::-webkit-scrollbar-thumb { background: var(--border); }

    .activity-item {
      padding: 8px 18px;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(6px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .activity-icon {
      width: 24px; height: 24px;
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.65rem;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .activity-body { flex: 1; min-width: 0; }

    .activity-text {
      font-size: 0.7rem;
      color: var(--text);
      line-height: 1.5;
    }

    .activity-time {
      font-size: 0.58rem;
      color: var(--muted);
      margin-top: 2px;
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      padding: 14px 18px;
      border-top: 1px solid var(--border);
    }

    .stat-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
    }

    .stat-val {
      font-family: var(--font-ui);
      font-weight: 800;
      font-size: 1.4rem;
      color: var(--dark);
      line-height: 1;
    }

    .stat-lbl {
      font-size: 0.58rem;
      color: var(--muted);
      margin-top: 3px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-family: var(--font-ui);
    }

    /* ADD TASK MODAL */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(26,22,18,0.7);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(3px);
    }

    .modal-overlay.hidden { display: none; }

    .modal {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 28px;
      width: 460px;
      box-shadow: var(--shadow-lg);
      animation: modalIn 0.2s ease;
    }

    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.96) translateY(-8px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal-title {
      font-family: var(--font-ui);
      font-weight: 800;
      font-size: 1.1rem;
      color: var(--dark);
      margin-bottom: 4px;
    }

    .modal-sub {
      font-size: 0.68rem;
      color: var(--muted);
      margin-bottom: 22px;
    }

    .form-row { margin-bottom: 14px; }

    .form-label {
      display: block;
      font-family: var(--font-ui);
      font-size: 0.62rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 5px;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 7px;
      padding: 9px 12px;
      color: var(--text);
      font-family: var(--font-mono);
      font-size: 0.8rem;
      outline: none;
      transition: border-color 0.15s;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      border-color: var(--amber);
      box-shadow: 0 0 0 3px rgba(193,127,36,0.1);
    }

    .form-textarea { resize: none; height: 80px; line-height: 1.5; }
    .form-select { appearance: none; cursor: pointer; }

    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    .modal-actions { display: flex; gap: 10px; margin-top: 22px; }

    .btn-primary {
      flex: 1;
      padding: 10px;
      background: var(--amber);
      border: none;
      color: white;
      font-family: var(--font-ui);
      font-weight: 700;
      font-size: 0.78rem;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      border-radius: 7px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-primary:hover { background: var(--amber-light); }

    .btn-cancel {
      padding: 10px 18px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      font-family: var(--font-ui);
      font-size: 0.78rem;
      border-radius: 7px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-cancel:hover { border-color: var(--text); color: var(--text); }

    /* P2P broadcast toast */
    .toast {
      position: fixed;
      bottom: 24px; right: 24px;
      background: var(--dark);
      color: #f5f0e8;
      padding: 12px 18px;
      border-radius: 8px;
      font-size: 0.72rem;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow-lg);
      z-index: 2000;
      animation: toastIn 0.3s ease;
      border-left: 3px solid var(--amber);
    }

    .toast.hidden { display: none; }

    @keyframes toastIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .empty-col {
      padding: 20px;
      text-align: center;
      font-size: 0.68rem;
      color: var(--muted);
      font-style: italic;
    }
  </style>
</head>
<body>

<!-- MODAL -->
<div class="modal-overlay hidden" id="modal">
  <div class="modal">
    <div class="modal-title">New Task</div>
    <div class="modal-sub">Broadcast task to agents via Intercom P2P sidechannel</div>
    <div class="form-row">
      <label class="form-label">Task Title</label>
      <input class="form-input" id="taskTitle" placeholder="e.g. Verify Solana escrow for trade-id 7f3a..."/>
    </div>
    <div class="form-row">
      <label class="form-label">Description</label>
      <textarea class="form-textarea" id="taskDesc" placeholder="Describe what needs to be done..."></textarea>
    </div>
    <div class="form-grid">
      <div class="form-row">
        <label class="form-label">Assign To</label>
        <select class="form-select" id="taskAssignee">
          <option value="Agent-7f3a">Agent-7f3a</option>
          <option value="OpenClaw-1">OpenClaw-1</option>
          <option value="SwapBot-Î±">SwapBot-Î±</option>
          <option value="Unassigned">Unassigned</option>
        </select>
      </div>
      <div class="form-row">
        <label class="form-label">Priority</label>
        <select class="form-select" id="taskPriority">
          <option value="high">High</option>
          <option value="medium" selected>Medium</option>
          <option value="low">Low</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <label class="form-label">Tag</label>
      <select class="form-select" id="taskTag">
        <option value="p2p">P2P</option>
        <option value="agent">Agent</option>
        <option value="contract">Contract</option>
        <option value="urgent">Urgent</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-primary" onclick="addTask()">â¬¡ Broadcast Task</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast hidden" id="toast">
  <span>â¬¡</span>
  <span id="toastMsg">Task broadcast via P2P sidechannel</span>
</div>

<!-- HEADER -->
<header>
  <div class="logo">
    â¬¡ IntercomTasks
    <span class="logo-badge">P2P</span>
  </div>
  <div class="header-right">
    <div class="network-pill">
      <div class="net-dot"></div>
      0000intercom
    </div>
    <span>TRAC NETWORK</span>
  </div>
</header>

<!-- MAIN -->
<div class="main">

  <!-- LEFT -->
  <div class="left-panel">
    <div class="panel-header">
      <span>Filters</span>
    </div>
    <div class="filter-list">
      <div class="filter-item active" onclick="filterTasks('all', this)">
        All Tasks
        <span class="filter-count" id="count-all">0</span>
      </div>
      <div class="filter-item" onclick="filterTasks('todo', this)">
        To Do
        <span class="filter-count" id="count-todo">0</span>
      </div>
      <div class="filter-item" onclick="filterTasks('inprogress', this)">
        In Progress
        <span class="filter-count" id="count-inprogress">0</span>
      </div>
      <div class="filter-item" onclick="filterTasks('done', this)">
        Done
        <span class="filter-count" id="count-done">0</span>
      </div>
      <div class="divider"></div>
      <div class="filter-item" onclick="filterTasks('high', this)">
        ðŸ”´ High Priority
        <span class="filter-count" id="count-high">0</span>
      </div>
      <div class="filter-item" onclick="filterTasks('medium', this)">
        ðŸŸ¡ Medium Priority
        <span class="filter-count" id="count-medium">0</span>
      </div>
      <div class="filter-item" onclick="filterTasks('low', this)">
        ðŸ”µ Low Priority
        <span class="filter-count" id="count-low">0</span>
      </div>
    </div>
    <div class="divider"></div>
    <div class="panel-header">Online Agents</div>
    <div class="agents-section">
      <div class="agent-row">
        <div class="agent-av" style="background:rgba(193,127,36,0.2);color:var(--amber-light)">AG</div>
        <div class="agent-av-info">
          <div class="agent-av-name">Agent-7f3a</div>
          <div class="agent-av-status" style="color:rgba(245,240,232,0.4)">Monitoring sidechannel</div>
        </div>
        <div class="online-dot"></div>
      </div>
      <div class="agent-row">
        <div class="agent-av" style="background:rgba(37,99,168,0.2);color:#60a5fa">OC</div>
        <div class="agent-av-info">
          <div class="agent-av-name">OpenClaw-1</div>
          <div class="agent-av-status" style="color:rgba(245,240,232,0.4)">Executing tasks</div>
        </div>
        <div class="online-dot busy"></div>
      </div>
      <div class="agent-row">
        <div class="agent-av" style="background:rgba(45,122,58,0.2);color:#4ade80">SW</div>
        <div class="agent-av-info">
          <div class="agent-av-name">SwapBot-Î±</div>
          <div class="agent-av-status" style="color:rgba(245,240,232,0.4)">Idle</div>
        </div>
        <div class="online-dot offline"></div>
      </div>
    </div>
    <div class="trac-box">
      <div class="trac-label">Trac Address</div>
      <div class="trac-addr">trac1647r8stvzt3msdfsfmd47j78rlswpujj356nj88k53wd6mw7tx4swuttum</div>
    </div>
  </div>

  <!-- BOARD -->
  <div class="task-board">
    <div class="board-header">
      <div>
        <div class="board-title">Agent Task Board</div>
        <div class="board-subtitle">Tasks broadcast over Intercom P2P sidechannels Â· channel: 0000intercom</div>
      </div>
      <button class="btn-add" onclick="openModal()">+ New Task</button>
    </div>
    <div class="kanban">
      <div class="column">
        <div class="col-header">
          <div class="col-title">
            <div class="col-dot" style="background:#9ca3af"></div>
            To Do
          </div>
          <span class="col-count" id="col-count-todo">0</span>
        </div>
        <div class="col-tasks" id="col-todo"></div>
      </div>
      <div class="column">
        <div class="col-header">
          <div class="col-title">
            <div class="col-dot" style="background:var(--amber)"></div>
            In Progress
          </div>
          <span class="col-count" id="col-count-inprogress">0</span>
        </div>
        <div class="col-tasks" id="col-inprogress"></div>
      </div>
      <div class="column">
        <div class="col-header">
          <div class="col-title">
            <div class="col-dot" style="background:var(--success)"></div>
            Done
          </div>
          <span class="col-count" id="col-count-done">0</span>
        </div>
        <div class="col-tasks" id="col-done"></div>
      </div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="right-panel">
    <div class="rp-header">P2P Activity Log</div>
    <div class="activity-feed" id="activityFeed"></div>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-val" id="stat-total">0</div>
        <div class="stat-lbl">Total Tasks</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" id="stat-done">0</div>
        <div class="stat-lbl">Completed</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" id="stat-agents">3</div>
        <div class="stat-lbl">Agents Online</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" id="stat-channel">P2P</div>
        <div class="stat-lbl">Network</div>
      </div>
    </div>
  </div>
</div>

<script>
  // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let tasks = [];
  let nextId = 1;
  let currentFilter = 'all';

  const ASSIGNEE_COLORS = {
    'Agent-7f3a': { bg: '#c17f24', initials: 'AG' },
    'OpenClaw-1': { bg: '#2563a8', initials: 'OC' },
    'SwapBot-Î±':  { bg: '#2d7a3a', initials: 'SW' },
    'Unassigned': { bg: '#9a9080', initials: '?' },
  };

  // â”€â”€ Seed data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const SEED = [
    { title: 'Verify Solana escrow for trade #7f3a', desc: 'Check escrow PDA on-chain and confirm USDT locked before LN payment.', assignee: 'Agent-7f3a', priority: 'high', tag: 'contract', status: 'todo' },
    { title: 'Monitor RFQ channel for new quotes', desc: 'Watch 0000intercomswapbtcusdt for incoming RFQ broadcasts.', assignee: 'OpenClaw-1', priority: 'medium', tag: 'p2p', status: 'inprogress' },
    { title: 'Open private sidechannel with maker', desc: 'Negotiate invite for swap:a9b3c2 after quote acceptance.', assignee: 'SwapBot-Î±', priority: 'medium', tag: 'agent', status: 'inprogress' },
    { title: 'Run LN route precheck', desc: 'Decode invoice and validate Lightning liquidity before escrow is created.', assignee: 'Agent-7f3a', priority: 'high', tag: 'urgent', status: 'todo' },
    { title: 'Sync subnet state with peers', desc: 'Replicate latest contract state across all connected Trac peers.', assignee: 'OpenClaw-1', priority: 'low', tag: 'p2p', status: 'done' },
    { title: 'Post svc_announce to rendezvous', desc: 'Broadcast service presence on 0000intercom with offer details.', assignee: 'SwapBot-Î±', priority: 'medium', tag: 'agent', status: 'done' },
  ];

  window.addEventListener('DOMContentLoaded', () => {
    SEED.forEach(t => addTaskData(t));
    addActivity('â¬¡', 'Connected to Trac Network via Hyperswarm DHT', 'rgba(193,127,36,0.15)', 'var(--amber)');
    addActivity('ðŸ“¡', 'Sidechannel 0000intercom joined â€” 3 agents online', 'rgba(37,99,168,0.1)', '#2563a8');
    addActivity('ðŸ”‘', 'Noise protocol handshake complete', 'rgba(45,122,58,0.1)', '#2d7a3a');
    renderAll();
    setInterval(randomActivity, 10000);
  });

  // â”€â”€ Task logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function addTaskData(data) {
    tasks.push({ id: nextId++, ...data, createdAt: new Date() });
  }

  function openModal() {
    document.getElementById('modal').classList.remove('hidden');
    document.getElementById('taskTitle').focus();
  }

  function closeModal() {
    document.getElementById('modal').classList.add('hidden');
  }

  function addTask() {
    const title = document.getElementById('taskTitle').value.trim();
    if (!title) return;
    const task = {
      id: nextId++,
      title,
      desc: document.getElementById('taskDesc').value.trim(),
      assignee: document.getElementById('taskAssignee').value,
      priority: document.getElementById('taskPriority').value,
      tag: document.getElementById('taskTag').value,
      status: 'todo',
      createdAt: new Date(),
    };
    tasks.push(task);
    closeModal();
    document.getElementById('taskTitle').value = '';
    document.getElementById('taskDesc').value = '';
    renderAll();
    showToast(`Task broadcast to ${task.assignee} via P2P`);
    addActivity('ðŸ“‹', `New task created: "${title}" â†’ assigned to ${task.assignee}`, 'rgba(193,127,36,0.1)', 'var(--amber)');
  }

  function moveTask(id, newStatus) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;
    task.status = newStatus;
    renderAll();
    const labels = { todo: 'To Do', inprogress: 'In Progress', done: 'Done' };
    showToast(`Task moved to ${labels[newStatus]}`);
    addActivity('ðŸ”„', `"${task.title}" moved to ${labels[newStatus]}`, 'rgba(37,99,168,0.1)', '#2563a8');
  }

  function deleteTask(id) {
    const task = tasks.find(t => t.id === id);
    tasks = tasks.filter(t => t.id !== id);
    renderAll();
    if (task) addActivity('ðŸ—‘ï¸', `Task deleted: "${task.title}"`, 'rgba(184,50,50,0.1)', 'var(--error)');
  }

  // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderAll() {
    const filtered = filterList();
    const todo = filtered.filter(t => t.status === 'todo');
    const inprogress = filtered.filter(t => t.status === 'inprogress');
    const done = filtered.filter(t => t.status === 'done');

    renderCol('col-todo', todo);
    renderCol('col-inprogress', inprogress);
    renderCol('col-done', done);

    document.getElementById('col-count-todo').textContent = todo.length;
    document.getElementById('col-count-inprogress').textContent = inprogress.length;
    document.getElementById('col-count-done').textContent = done.length;

    // sidebar counts
    document.getElementById('count-all').textContent = tasks.length;
    document.getElementById('count-todo').textContent = tasks.filter(t=>t.status==='todo').length;
    document.getElementById('count-inprogress').textContent = tasks.filter(t=>t.status==='inprogress').length;
    document.getElementById('count-done').textContent = tasks.filter(t=>t.status==='done').length;
    document.getElementById('count-high').textContent = tasks.filter(t=>t.priority==='high').length;
    document.getElementById('count-medium').textContent = tasks.filter(t=>t.priority==='medium').length;
    document.getElementById('count-low').textContent = tasks.filter(t=>t.priority==='low').length;

    // stats
    document.getElementById('stat-total').textContent = tasks.length;
    document.getElementById('stat-done').textContent = tasks.filter(t=>t.status==='done').length;
  }

  function filterList() {
    if (currentFilter === 'all') return tasks;
    if (['todo','inprogress','done'].includes(currentFilter)) return tasks.filter(t => t.status === currentFilter);
    if (['high','medium','low'].includes(currentFilter)) return tasks.filter(t => t.priority === currentFilter);
    return tasks;
  }

  function renderCol(colId, list) {
    const el = document.getElementById(colId);
    el.innerHTML = '';
    if (list.length === 0) {
      el.innerHTML = '<div class="empty-col">No tasks here</div>';
      return;
    }
    list.forEach(task => {
      const a = ASSIGNEE_COLORS[task.assignee] || ASSIGNEE_COLORS['Unassigned'];
      const nextStatus = task.status === 'todo' ? 'inprogress' : task.status === 'inprogress' ? 'done' : 'todo';
      const nextLabel = task.status === 'todo' ? 'Start' : task.status === 'inprogress' ? 'Complete' : 'Reopen';
      const card = document.createElement('div');
      card.className = `task-card priority-${task.priority}`;
      card.innerHTML = `
        <div class="task-title">${escHtml(task.title)}</div>
        ${task.desc ? `<div class="task-desc">${escHtml(task.desc)}</div>` : ''}
        <div class="task-meta">
          <div class="task-tags">
            <span class="tag tag-${task.tag}">${task.tag}</span>
            <span class="tag" style="background:rgba(0,0,0,0.05);color:var(--muted)">${task.priority}</span>
          </div>
          <div class="task-assignee">
            <div class="assignee-dot" style="background:${a.bg}">${a.initials}</div>
            ${escHtml(task.assignee)}
          </div>
        </div>
        <div class="task-actions">
          <button class="task-btn complete" onclick="moveTask(${task.id},'${nextStatus}')">${nextLabel}</button>
          <button class="task-btn delete" onclick="deleteTask(${task.id})">Delete</button>
        </div>`;
      el.appendChild(card);
    });
  }

  function filterTasks(type, el) {
    document.querySelectorAll('.filter-item').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
    currentFilter = type;
    renderAll();
  }

  // â”€â”€ Activity feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function addActivity(icon, text, iconBg, iconColor) {
    const feed = document.getElementById('activityFeed');
    const item = document.createElement('div');
    item.className = 'activity-item';
    item.innerHTML = `
      <div class="activity-icon" style="background:${iconBg};color:${iconColor}">${icon}</div>
      <div class="activity-body">
        <div class="activity-text">${text}</div>
        <div class="activity-time">${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
      </div>`;
    feed.insertBefore(item, feed.firstChild);
    // keep max 20
    while (feed.children.length > 20) feed.removeChild(feed.lastChild);
  }

  function randomActivity() {
    const events = [
      ['ðŸ“¡', 'Agent-7f3a broadcast presence on 0000intercom', 'rgba(193,127,36,0.1)', 'var(--amber)'],
      ['ðŸ”—', 'New peer connected via Hyperswarm DHT', 'rgba(37,99,168,0.1)', '#2563a8'],
      ['â¬¡', 'Subnet state replicated to 3 peers', 'rgba(45,122,58,0.1)', '#2d7a3a'],
      ['ðŸ’¬', 'OpenClaw-1 sent status update via sidechannel', 'rgba(193,127,36,0.1)', 'var(--amber)'],
      ['ðŸ”', 'Noise handshake with new peer complete', 'rgba(45,122,58,0.1)', '#2d7a3a'],
    ];
    const e = events[Math.floor(Math.random() * events.length)];
    addActivity(...e);
  }

  // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showToast(msg) {
    const t = document.getElementById('toast');
    document.getElementById('toastMsg').textContent = msg;
    t.classList.remove('hidden');
    setTimeout(() => t.classList.add('hidden'), 3000);
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function escHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  document.getElementById('modal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
  });

  // â”€â”€ AUTONOMOUS AGENT (Agent-IzuuW) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Agent-IzuuW is a built-in autonomous agent that monitors the board over
  // the Intercom P2P sidechannel and manages tasks automatically.

  const AGENT = {
    name: 'Agent-IzuuW',
    initials: 'IW',
    color: '#a855f7',
    bg: 'rgba(168,85,247,0.15)',
    tracAddress: 'trac1647r8stvzt3msdfsfmd47j78rlswpujj356nj88k53wd6mw7tx4swuttum',
    thinking: false,
  };

  // Add Agent-IzuuW to the agents panel on load
  window.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      const agentsSection = document.querySelector('.agents-section');
      const agentEl = document.createElement('div');
      agentEl.className = 'agent-row';
      agentEl.id = 'taskmaster-row';
      agentEl.innerHTML = `
        <div class="agent-av" style="background:${AGENT.bg};color:${AGENT.color}">${AGENT.initials}</div>
        <div class="agent-av-info">
          <div class="agent-av-name" style="color:${AGENT.color}">Agent-IzuuW</div>
          <div class="agent-av-status" id="tm-status" style="color:rgba(245,240,232,0.4)">${AGENT.tracAddress.slice(0,16)}...</div>
        </div>
        <div class="online-dot" style="background:${AGENT.color};box-shadow:0 0 6px ${AGENT.color}"></div>`;
      agentsSection.appendChild(agentEl);

      // Boot sequence
      setTimeout(() => agentLog('Connecting to 0000intercom sidechannel...'), 500);
      setTimeout(() => agentLog('Noise handshake complete âœ“'), 1200);
      setTimeout(() => agentLog('Scanning task board...'), 2000);
      setTimeout(() => {
        setAgentStatus('Active â€” monitoring board');
        agentLog(`Agent-IzuuW online. Identity: ${AGENT.tracAddress.slice(0,20)}...`);
        addActivity('ðŸ¤–', `Agent-IzuuW (${AGENT.tracAddress.slice(0,16)}...) joined via P2P sidechannel â€” autonomous mode active`, AGENT.bg, AGENT.color);
        startAgentLoop();
      }, 3000);
    }, 1500);
  });

  function setAgentStatus(status) {
    const el = document.getElementById('tm-status');
    if (el) el.textContent = status;
  }

  function agentLog(msg) {
    addActivity('ðŸ¤–', `[Agent-IzuuW] ${msg}`, AGENT.bg, AGENT.color);
  }

  function agentToast(msg) {
    showToast(`ðŸ¤– Agent-IzuuW: ${msg}`);
  }

  // â”€â”€ Agent Loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startAgentLoop() {
    // Every 8s agent does something smart
    setInterval(() => {
      if (AGENT.thinking) return;
      const action = Math.random();

      if (action < 0.3) {
        agentPickUpTask();
      } else if (action < 0.55) {
        agentCompleteTask();
      } else if (action < 0.72) {
        agentCreateTask();
      } else if (action < 0.86) {
        agentReassignTask();
      } else {
        agentBroadcastStatus();
      }
    }, 8000);
  }

  // Agent picks up a todo task and moves it to in progress
  function agentPickUpTask() {
    const todoTasks = tasks.filter(t => t.status === 'todo');
    if (todoTasks.length === 0) return;
    // Prioritise high priority tasks
    const high = todoTasks.filter(t => t.priority === 'high');
    const target = high.length > 0
      ? high[Math.floor(Math.random() * high.length)]
      : todoTasks[Math.floor(Math.random() * todoTasks.length)];

    AGENT.thinking = true;
    setAgentStatus('Picking up task...');
    agentLog(`Detected unassigned task: "${target.title}" â€” priority: ${target.priority}`);

    setTimeout(() => {
      target.assignee = 'Agent-IzuuW';
      target.status = 'inprogress';
      renderAll();
      agentLog(`Claimed task via sidechannel: "${target.title}"`);
      agentToast(`Picked up "${target.title}"`);
      setAgentStatus('Working on task...');
      AGENT.thinking = false;
    }, 2500);
  }

  // Agent completes an in-progress task
  function agentCompleteTask() {
    const myTasks = tasks.filter(t => t.status === 'inprogress' && t.assignee === 'Agent-IzuuW');
    if (myTasks.length === 0) {
      // Complete any in-progress task
      const inProgress = tasks.filter(t => t.status === 'inprogress');
      if (inProgress.length === 0) return;
      const target = inProgress[Math.floor(Math.random() * inProgress.length)];
      AGENT.thinking = true;
      setAgentStatus('Completing task...');
      agentLog(`Assisting with task: "${target.title}" â€” running verification...`);
      setTimeout(() => {
        target.status = 'done';
        renderAll();
        agentLog(`Task completed and verified: "${target.title}" âœ“`);
        agentToast(`Completed "${target.title}"`);
        setAgentStatus('Active â€” monitoring board');
        AGENT.thinking = false;
      }, 3000);
      return;
    }
    const target = myTasks[0];
    AGENT.thinking = true;
    setAgentStatus('Completing task...');
    agentLog(`Finalising task: "${target.title}" â€” posting proof to sidechannel...`);
    setTimeout(() => {
      target.status = 'done';
      renderAll();
      agentLog(`Task marked complete: "${target.title}" â€” proof broadcast to peers âœ“`);
      agentToast(`Completed "${target.title}"`);
      setAgentStatus('Active â€” monitoring board');
      AGENT.thinking = false;
    }, 3000);
  }

  // Agent creates a new task
  function agentCreateTask() {
    const agentTasks = [
      { title: 'Verify peer signatures on subnet', desc: 'Check all peer signatures are valid on the current subnet state.', priority: 'medium', tag: 'p2p' },
      { title: 'Rebroadcast service announcement', desc: 'Post svc_announce to 0000intercom â€” sidechannels have no history.', priority: 'low', tag: 'agent' },
      { title: 'Check escrow timeout windows', desc: 'Scan open trades for approaching sol_refund_after_unix deadlines.', priority: 'high', tag: 'urgent' },
      { title: 'Sync contract state with peers', desc: 'Replicate latest deterministic state to all connected Trac peers.', priority: 'medium', tag: 'contract' },
      { title: 'Monitor RFQ channel for stale quotes', desc: 'Remove expired quotes from 0000intercomswapbtcusdt.', priority: 'low', tag: 'p2p' },
      { title: 'Run LN node health check', desc: 'Verify Lightning node connectivity and channel liquidity levels.', priority: 'high', tag: 'urgent' },
    ];
    const t = agentTasks[Math.floor(Math.random() * agentTasks.length)];
    AGENT.thinking = true;
    setAgentStatus('Creating task...');
    agentLog(`Detected action needed: "${t.title}" â€” creating task via sidechannel...`);
    setTimeout(() => {
      tasks.push({
        id: nextId++,
        title: t.title,
        desc: t.desc,
        assignee: 'Agent-IzuuW',
        priority: t.priority,
        tag: t.tag,
        status: 'todo',
        createdAt: new Date(),
      });
      renderAll();
      agentLog(`New task broadcast to board: "${t.title}"`);
      agentToast(`Created new task: "${t.title}"`);
      setAgentStatus('Active â€” monitoring board');
      AGENT.thinking = false;
    }, 2000);
  }

  // Agent reassigns a task to another agent
  function agentReassignTask() {
    const unassigned = tasks.filter(t => t.status === 'todo' && t.assignee === 'Unassigned');
    if (unassigned.length === 0) return;
    const target = unassigned[Math.floor(Math.random() * unassigned.length)];
    const agents = ['Agent-7f3a', 'OpenClaw-1', 'SwapBot-Î±'];
    const newAgent = agents[Math.floor(Math.random() * agents.length)];
    AGENT.thinking = true;
    setAgentStatus('Reassigning task...');
    agentLog(`Unassigned task detected: "${target.title}" â€” finding best agent...`);
    setTimeout(() => {
      target.assignee = newAgent;
      renderAll();
      agentLog(`Task reassigned to ${newAgent} via private sidechannel invite`);
      agentToast(`Assigned "${target.title}" to ${newAgent}`);
      setAgentStatus('Active â€” monitoring board');
      AGENT.thinking = false;
    }, 2000);
  }

  // Agent broadcasts status
  function agentBroadcastStatus() {
    const total = tasks.length;
    const done = tasks.filter(t => t.status === 'done').length;
    const inprog = tasks.filter(t => t.status === 'inprogress').length;
    const high = tasks.filter(t => t.priority === 'high' && t.status !== 'done').length;
    agentLog(`Board status broadcast: ${total} total, ${inprog} in progress, ${done} done, ${high} high priority pending`);
    setAgentStatus(`Monitoring â€” ${total} tasks`);
  }
</script>
</body>
</html>